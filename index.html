<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Media Selector</title>
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      background: #f4f6f9;
      padding: 40px;
      color: #333;
    }

    h1 {
      text-align: center;
      color: #2c3e50;
    }

    #controls {
      display: flex;
      justify-content: center;
      align-items: center;
      margin-bottom: 20px;
      gap: 15px;
    }

    select, button {
      padding: 10px;
      font-size: 16px;
      border-radius: 6px;
      border: 1px solid #ccc;
    }

    button {
      background-color: #007BFF;
      color: white;
      border: none;
      transition: background-color 0.3s;
    }

    button:hover {
      background-color: #0056b3;
    }

    #movieList {
      max-width: 800px;
      margin: auto;
      background: white;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }

    .movie {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 10px 0;
      border-bottom: 1px solid #eee;
    }

    .movie:last-child {
      border-bottom: none;
    }

    .movie label {
      flex-grow: 1;
      margin-left: 10px;
    }

    #summary {
      text-align: center;
      margin-top: 20px;
      font-weight: bold;
    }

    @media (max-width: 600px) {
      #controls {
        flex-direction: column;
      }

      .movie {
        flex-direction: column;
        align-items: flex-start;
      }

      .movie label {
        margin-left: 0;
        margin-top: 5px;
      }
    }
  </style>
</head>
<body>

  <h1>Media Selection Tool</h1>

  <div id="controls">
    <select id="mediaType" onchange="switchMediaType()">
      <option value="movies">Movies</option>
      <option value="tvshows">TV Shows</option>
    </select>
    <button onclick="downloadSelection()">Download Selected</button>
  </div>

  <div id="movieList"></div>
  <div id="summary">Selected: 0 | Total Size: 0 GB</div>

  <script>
    let mediaType = 'movies';
    let movies = [];
    let selectedMap = new Map();
    let totalSize = 0;
    let downloadRequired = false;

    document.addEventListener('DOMContentLoaded', function () {
      loadCSV();
    });

    function switchMediaType() {
      if (downloadRequired && selectedMap.size > 0) {
        alert('Please download your selections before switching to a different media type.');
        document.getElementById('mediaType').value = mediaType;
        return;
      }
      mediaType = document.getElementById('mediaType').value;
      resetSelections();
      loadCSV();
    }

    function resetSelections() {
      movies = [];
      selectedMap.clear();
      totalSize = 0;
      updateSummary();
      downloadRequired = false;
    }

    function loadCSV() {
      const csvFile = `${mediaType}.csv`;
      fetch(csvFile)
        .then(response => response.text())
        .then(data => {
          parseCSV(data);
        })
        .catch(error => console.error('Error loading CSV:', error));
    }

    function parseCSV(csvData) {
      const lines = csvData.trim().split('\n').slice(1);
      movies = lines.map(line => {
        const [title, size] = line.split(',').map(field => field.trim());
        return { title, size: parseFloat(size) };
      });
      renderMovies();
    }

    function renderMovies() {
      const container = document.getElementById('movieList');
      container.innerHTML = '';

      movies.forEach(movie => {
        const div = document.createElement('div');
        div.className = 'movie';

        const checkbox = document.createElement('input');
        checkbox.type = 'checkbox';
        checkbox.onchange = () => handleSelect(movie, checkbox);

        const label = document.createElement('label');
        label.textContent = `${movie.title} (${movie.size} GB)`;

        div.appendChild(checkbox);
        div.appendChild(label);
        container.appendChild(div);
      });
    }

    function handleSelect(movie, checkbox) {
      if (checkbox.checked) {
        if (totalSize + movie.size > 1000) {
          alert("Total size limit exceeded (1000 GB)!");
          checkbox.checked = false;
        } else {
          selectedMap.set(movie.title, movie.size);
          totalSize += movie.size;
        }
      } else {
        selectedMap.delete(movie.title);
        totalSize -= movie.size;
      }

      updateSummary();
      downloadRequired = selectedMap.size > 0;
    }

    function updateSummary() {
      document.getElementById('summary').textContent =
        `Selected: ${selectedMap.size} | Total Size: ${totalSize.toFixed(2)} GB`;
    }

    function downloadSelection() {
      if (selectedMap.size === 0) {
        alert("No selections to download!");
        return;
      }

      const lines = [];
      selectedMap.forEach((size, title) => {
        lines.push(`${title} (${size} GB)`);
      });
      lines.push(`\nTotal Selected: ${selectedMap.size}`);
      lines.push(`Total Size: ${totalSize.toFixed(2)} GB`);

      const blob = new Blob([lines.join('\n')], { type: 'text/plain' });
      const link = document.createElement('a');
      link.href = URL.createObjectURL(blob);
      link.download = `${mediaType}_selection.txt`;
      link.click();

      // Reset after download
      resetSelections();
      renderMovies();
    }
  </script>
</body>
</html>
